<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="./pocketgrid.css" type="text/css" rel="stylesheet"/>
		<link href="./responsive.css" type="text/css" rel="stylesheet"/>
		<link href="./jquery-ui.min.css" type="text/css" rel="stylesheet"/>
		<link href="./jquery-ui.theme.css" type="text/css" rel="stylesheet"/>
		<title>Reisblog Ruth en Kurt</title>
	</head>

	<body>

		<div class="block-group">
			<header class="block">
			<script id="headerscript" type="text/ractive">
				<h1>{{titel}} </h1>
				<h2>{{subtitel}}</h2>
			</script>
			</header>

			<nav class="block">
			<div class="travelinfo">
			</div>
			</nav>

			<section class="block blog">
			</section>

			<footer class="block">Footer</footer>
		</div>
		<script id="blog" type="text/ractive">
			{{#each posts}}
			{{>post}}
			{{/each}}
		</script>

		<script id='post' type='text/ractive'>
			<article class="block-group">
			<h1 on-click="ui-toggle:{{flickr}}">{{title}}</h1>


			<div class="block content">
				<div class="block summary">
					{{{summary}}}
				</div>
				<div class="block text">
					{{{text}}}
				</div>
				<div class="block pics">
                 <ul class="clearing-thumbs" data-clearing></ul>
				</div>
			</div>
			<div class="block comment">comment 1</div>
			</article>
		</script>

		<script src="jquery.js"></script>
		<script src='http://cdn.ractivejs.org/latest/ractive.min.js'></script>

		<script src="foundation.js"></script>
		<script src="foundation.clearing.js"></script>
		<script src="flickr.js"></script>

		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
		<script src="http://rangy.googlecode.com/svn/trunk/currentrelease/rangy-core.js"></script>
		<script src="hallo.js"></script>

		<script src="http://cdn.sockjs.org/sockjs-0.3.4.min.js"></script>
		<script src="vertxbus.js"></script>

		<script src="app.js"></script>

		<script>
			var eb = null;

			var posts = new Ractive({
				el: 'section.blog',
				template: '#blog'
			});
			posts.on('ui-toggle', function(event, flickr) {
				$(event.node).siblings('div').slideToggle('slow');
				flickr.container= '<li class="photos-set-item" />';
				flickr.cssClass= 'photos-set-link';
				var picsDiv = $(event.node).next('.content').children('.pics').first();
				picsDiv.children('ul').first().flickrPhotoStream(flickr)
					.done(function () {
						picsDiv.foundation();
					});
			})


			var travelinfo = new Ractive({
				el: 'nav .travelinfo',
				template: '{{name}} {{period}} {{countries}}'
			});

			var session = {
				travel: 1
			};

			$(document).ready(function() {
				eb = new vertx.EventBus("http://test.tinyleaps.be/eventbus");
				eb.onopen = function() {

					eb.send("be.qsys.tinyleaps.api", 
					{
						action: "blogs",
						pars: 
						{
							travel: session.travel,
							limit: 100,
							offset: 0 
						}
					},
					function(reply) {
						posts.set('posts', reply.result); 
					});

					eb.send("be.qsys.tinyleaps.api", 
					{
						action: "travelinfo",
						pars: 
						{
							travel: session.travel 
						}
					},
					function(reply) {
						travelinfo.set('info', reply.result[0]); 
					});
				}
			});

		</script>


	</body>
</html>
